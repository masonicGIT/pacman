<!doctype html>
<html>

<head>

    <title>Crypto Pac-Man — Satoshi's Revenge</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta names="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <link rel="apple-touch-icon-precomposed" href="icon/ios_icon.png"/>
    <link rel="icon" type="image/png" href="icon/favicon.png"/>

    <style>
        body {
            margin: 0;
            background: #0a0a0a;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        @font-face {
            font-family: 'ArcadeR';
            src: url('font/ARCADE_R.TTF');
        }
        #canvas-warning {
            color: #FF0;
            font-size: 1.5em;
        }
        #crypto-header {
            font-family: 'ArcadeR', monospace;
            color: #f7931a;
            font-size: 1.4em;
            text-align: center;
            padding: 10px 0 4px 0;
            letter-spacing: 4px;
            text-shadow: 0 0 12px #f7931a88;
        }
        #crypto-sub {
            font-family: 'ArcadeR', monospace;
            color: #ffd700;
            font-size: 0.6em;
            text-align: center;
            padding-bottom: 8px;
            letter-spacing: 2px;
            opacity: 0.8;
        }
        canvas#canvas {
            border: 2px solid #f7931a;
            box-shadow: 0 0 24px #f7931a66;
            display: block;
        }
    </style>

<script src="pacman.js"></script>

</head>

<body>

    <div id="crypto-header">₿ CRYPTO PAC-MAN</div>
    <div id="crypto-sub">SATOSHI'S REVENGE</div>

    <div style='font-family: ArcadeR'> </div>
    <canvas id='canvas'><div id="canvas-warning">Your browser does not support HTML Canvas.  Please upgrade!</div></canvas>
    <canvas id='atlas' style="display:none"></canvas>

<script>
// ── Crypto Pac-Man Overrides ──────────────────────────────────────────────────
// All changes live here; pacman.js is untouched.

(function applyCryptoPatch() {

    // --- Ghost names (cosmetic only, doesn't affect logic) ---
    function patchGhosts() {
        if (typeof blinky !== 'undefined') {
            blinky.name = "bearish";   // Bear market ghost — stays red
            pinky.name  = "fud";       // FUD ghost — stays pink
            inky.name   = "sec";       // SEC ghost — stays cyan
            clyde.name  = "whale";     // Whale ghost — stays orange
        }
    }

    // --- Fruit name remapping (cherry→bitcoin, etc.) ---
    // We patch the fruits arrays on both PacFruit and MsPacFruit instances
    // after the game constructs them. The sprite image stays the same —
    // only the name (used for points display) is changed.
    var CRYPTO_NAMES = {
        'cherry':     'bitcoin',
        'strawberry': 'ethereum',
        'orange':     'xrp',
        'apple':      'solana',
        'melon':      'doge',
        'galaxian':   'bnb',
        'bell':       'avax',
        'key':        'usdc',
    };

    function patchFruits(fruitObj) {
        if (!fruitObj || !fruitObj.fruits) return;
        fruitObj.fruits.forEach(function(f) {
            if (CRYPTO_NAMES[f.name]) f.name = CRYPTO_NAMES[f.name];
        });
        // rebuild history if already built
        if (typeof fruitObj.buildFruitHistory === 'function') {
            try { fruitObj.buildFruitHistory(); } catch(e) {}
        }
    }

    // --- Message overrides ---
    // Wrap renderer.drawMessage to substitute crypto strings
    var MESSAGE_MAP = {
        'GAME  OVER': 'YOU  REKT',
        'PLAYER ONE': 'PLAYER  1',
        'READY ':     'HODL! ',
    };

    function patchRenderer() {
        if (typeof renderer === 'undefined' || !renderer.drawMessage) return;
        var _orig = renderer.drawMessage.bind(renderer);
        renderer.drawMessage = function(text, color, x, y) {
            var mapped = MESSAGE_MAP[text];
            return _orig(mapped !== undefined ? mapped : text, color, x, y);
        };
    }

    // --- Score label canvas override ---
    // The "1UP" / "HIGH SCORE" labels are drawn directly in the render loop.
    // We intercept CanvasRenderingContext2D.fillText on the main canvas to remap them.
    function patchScoreLabels() {
        var canvas = document.getElementById('canvas');
        if (!canvas) return;
        var ctx = canvas.getContext('2d');
        if (!ctx || ctx.__cryptoPatched) return;
        ctx.__cryptoPatched = true;
        var _fillText = ctx.fillText.bind(ctx);
        ctx.fillText = function(text) {
            var args = Array.prototype.slice.call(arguments);
            if (args[0] === '1UP')         args[0] = 'SATS';
            else if (args[0] === 'HIGH SCORE') args[0] = 'ALL TIME HIGH';
            else if (args[0] === 'PRACTICE')   args[0] = 'PRACTICE';
            return _fillText.apply(ctx, args);
        };
    }

    // --- Apply all patches once the game initialises ---
    // pacman.js fires window.onload itself to kick off the game loop.
    // We hook in right after by queuing a short polling check.
    var attempts = 0;
    function tryPatch() {
        attempts++;
        patchGhosts();
        patchRenderer();

        // patch fruit objects (game exposes them as globals: fruit)
        if (typeof fruit !== 'undefined') {
            patchFruits(fruit);
        }

        patchScoreLabels();

        if (attempts < 80) {
            // keep re-patching for a second or two to catch lazy init
            setTimeout(tryPatch, 50);
        }
    }

    // Start patching once the page is loaded (after pacman.js window.onload ran)
    window.addEventListener('load', function() {
        setTimeout(tryPatch, 100);
    });

})();
</script>

</body>

</html>
